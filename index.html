<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PacknDash CRM - Movers and Packers CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            background-color: #e2e8f0;
        }
        .progress {
            border-radius: 3px;
            height: 100%;
        }
        .step-active {
            background-color: #1d4ed8;
            color: white;
        }
        .step-completed {
            background-color: #16a34a;
            color: white;
        }
        .step-pending {
            background-color: #e2e8f0;
            color: #64748b;
        }
        .customer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .tab-active {
            border-bottom: 3px solid #1d4ed8;
            color: #1d4ed8;
            font-weight: 600;
        }
    </style>
    <script>
        // Initialize data storage
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize with sample data if empty
            if (!localStorage.getItem('packndash_customers')) {
                const initialCustomers = [
                    {
                        id: 1,
                        name: 'Karim El Alaili',
                        type: 'residential',
                        phone: '+971 50 123 4567',
                        email: 'karim@example.com',
                        address: 'Downtown Dubai, Burj Khalifa Area',
                        moveDate: '2023-11-15',
                        status: 'completed',
                        rating: 5,
                        review: 'Usman and his team handled our move last weekend and they were beyond fantastic! Arrived early, packed neatly and efficiently, and got us settled in our new home in no time. Highly recommended',
                        moveSize: '3-bedroom apartment',
                        services: ['Packing', 'Furniture Dismantling', 'Storage'],
                        stepStatus: {
                            plan: 'completed',
                            pack: 'completed',
                            load: 'completed',
                            deliver: 'completed'
                        }
                    },
                    {
                        id: 2,
                        name: 'Jiji Jayan',
                        type: 'residential',
                        phone: '+971 52 765 4321',
                        email: 'jiji@example.com',
                        address: 'Jumeirah Beach Residence',
                        moveDate: '2023-11-20',
                        status: 'scheduled',
                        rating: 5,
                        review: 'The team is fantastic. This is the second time we have used the team service. They are very professional, punctual, and knowledgeable. Great team. Highly recommended.',
                        moveSize: '2-bedroom apartment',
                        services: ['Packing', 'Vehicle Transport'],
                        stepStatus: {
                            plan: 'completed',
                            pack: 'in-progress',
                            load: 'pending',
                            deliver: 'pending'
                        }
                    },
                    {
                        id: 3,
                        name: 'Yasmin Hamadeh',
                        type: 'commercial',
                        phone: '+971 55 987 6543',
                        email: 'yasmin@business.ae',
                        address: 'Business Bay, Dubai',
                        moveDate: '2023-11-10',
                        status: 'in-progress',
                        rating: 5,
                        review: 'Very professional team, very fast and kind at a very affordable price. Definitely would advise dealing with them.',
                        moveSize: 'Office (500 sq ft)',
                        services: ['Commercial Moving', 'Document Storage'],
                        stepStatus: {
                            plan: 'completed',
                            pack: 'in-progress',
                            load: 'pending',
                            deliver: 'pending'
                        }
                    },
                    {
                        id: 4,
                        name: 'Baban',
                        type: 'residential',
                        phone: '+971 56 111 2222',
                        email: 'baban@example.com',
                        address: 'Dubai Marina',
                        moveDate: '2023-11-05',
                        status: 'completed',
                        rating: 5,
                        review: 'Amazing work by Raza, Imran, Arsalan. The moving-in process was really smooth and everything from dismantling to installation was handled with care and they were perfect at their job. Highly recommended.',
                        moveSize: '4-bedroom villa',
                        services: ['Full Service', 'Furniture Assembly', 'Storage'],
                        stepStatus: {
                            plan: 'completed',
                            pack: 'completed',
                            load: 'completed',
                            deliver: 'completed'
                        }
                    }
                ];
                localStorage.setItem('packndash_customers', JSON.stringify(initialCustomers));
            }
            
            // Initialize with stats
            if (!localStorage.getItem('packndash_stats')) {
                const initialStats = {
                    happyCustomers: 1253,
                    successfulMoves: 2107,
                    activeMoves: 18,
                    revenue: 142500
                };
                localStorage.setItem('packndash_stats', JSON.stringify(initialStats));
            }
            
            // Load the CRM
            loadCRM();
        });
        
        // Main CRM loading function
        function loadCRM() {
            renderDashboard();
            setupEventListeners();
        }
        
        // Set up all event listeners
        function setupEventListeners() {
            // Tab switching
            document.querySelectorAll('[data-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('[data-tab]').forEach(t => {
                        t.classList.remove('tab-active');
                    });
                    this.classList.add('tab-active');
                    
                    const tabId = this.getAttribute('data-tab');
                    if (tabId === 'dashboard') renderDashboard();
                    if (tabId === 'customers') renderCustomers();
                    if (tabId === 'moves') renderMoves();
                });
            });
            
            // Search functionality
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const activeTab = document.querySelector('[data-tab].tab-active')?.getAttribute('data-tab') || 'dashboard';
                    if (activeTab === 'dashboard') renderDashboard();
                    if (activeTab === 'customers') renderCustomers();
                    if (activeTab === 'moves') renderMoves();
                });
            }
            
            // New move button
            const newMoveBtn = document.getElementById('newMoveBtn');
            if (newMoveBtn) {
                newMoveBtn.addEventListener('click', function() {
                    document.getElementById('newMoveModal').style.display = 'block';
                });
            }
            
            // Close modal
            const closeBtn = document.querySelector('.close-modal');
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    document.getElementById('newMoveModal').style.display = 'none';
                });
            }
            
            // Create new move
            const moveForm = document.getElementById('moveForm');
            if (moveForm) {
                moveForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const formData = {
                        id: Date.now(),
                        name: document.getElementById('name').value,
                        type: document.getElementById('type').value,
                        phone: document.getElementById('phone').value,
                        email: document.getElementById('email').value,
                        address: document.getElementById('address').value,
                        moveDate: document.getElementById('moveDate').value,
                        status: 'scheduled',
                        moveSize: document.getElementById('moveSize').value,
                        services: []
                    };
                    
                    // Get selected services
                    document.querySelectorAll('#moveForm input[name="services"]:checked').forEach(service => {
                        formData.services.push(service.value);
                    });
                    
                    // Add default step status
                    formData.stepStatus = {
                        plan: 'completed',
                        pack: 'pending',
                        load: 'pending',
                        deliver: 'pending'
                    };
                    
                    // Save to localStorage
                    let customers = JSON.parse(localStorage.getItem('packndash_customers')) || [];
                    customers.push(formData);
                    localStorage.setItem('packndash_customers', JSON.stringify(customers));
                    
                    // Update stats
                    let stats = JSON.parse(localStorage.getItem('packndash_stats'));
                    stats.activeMoves += 1;
                    localStorage.setItem('packndash_stats', JSON.stringify(stats));
                    
                    // Close modal and refresh
                    document.getElementById('newMoveModal').style.display = 'none';
                    moveForm.reset();
                    
                    // Show success message
                    alert('New move request created successfully!');
                    
                    // Refresh the moves view
                    renderMoves();
                });
            }
            
            // Mark step as completed
            document.addEventListener('click', function(e) {
                if (e.target && e.target.matches('.step-btn')) {
                    const customerId = e.target.getAttribute('data-customer-id');
                    const step = e.target.getAttribute('data-step');
                    
                    let customers = JSON.parse(localStorage.getItem('packndash_customers'));
                    const customerIndex = customers.findIndex(c => c.id == customerId);
                    
                    if (customerIndex !== -1) {
                        // Update step status
                        customers[customerIndex].stepStatus[step] = 'completed';
                        
                        // Move to next step if available
                        const steps = ['plan', 'pack', 'load', 'deliver'];
                        const currentStepIndex = steps.indexOf(step);
                        if (currentStepIndex < steps.length - 1) {
                            const nextStep = steps[currentStepIndex + 1];
                            customers[customerIndex].stepStatus[nextStep] = 'in-progress';
                        }
                        
                        // Update move status if all steps completed
                        const allStepsCompleted = Object.values(customers[customerIndex].stepStatus).every(s => s === 'completed');
                        if (allStepsCompleted) {
                            customers[customerIndex].status = 'completed';
                            
                            // Update stats
                            let stats = JSON.parse(localStorage.getItem('packndash_stats'));
                            stats.successfulMoves += 1;
                            stats.activeMoves -= 1;
                            localStorage.setItem('packndash_stats', JSON.stringify(stats));
                        }
                        
                        localStorage.setItem('packndash_customers', JSON.stringify(customers));
                        
                        // Refresh the view
                        if (document.querySelector('[data-tab].tab-active')?.getAttribute('data-tab') === 'dashboard') {
                            renderDashboard();
                        } else {
                            renderMoves();
                        }
                        
                        alert('Step marked as completed!');
                    }
                }
            });
            
            // View customer details
            document.addEventListener('click', function(e) {
                if (e.target && e.target.matches('.view-details')) {
                    const customerId = e.target.getAttribute('data-customer-id');
                    showCustomerDetails(customerId);
                }
            });
            
            // Close details modal
            document.addEventListener('click', function(e) {
                if (e.target && e.target.matches('.close-details')) {
                    document.getElementById('customerDetailsModal').style.display = 'none';
                }
            });
        }
        
        // Render Dashboard
        function renderDashboard() {
            const searchQuery = document.getElementById('searchInput')?.value?.toLowerCase() || '';
            const customers = JSON.parse(localStorage.getItem('packndash_customers')) || [];
            const stats = JSON.parse(localStorage.getItem('packndash_stats')) || {
                happyCustomers: 1253,
                successfulMoves: 2107,
                activeMoves: 18,
                revenue: 142500
            };
            
            // Filter customers
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchQuery) ||
                customer.phone.includes(searchQuery) ||
                customer.address.toLowerCase().includes(searchQuery)
            );
            
            // Active moves
            const activeMoves = filteredCustomers.filter(customer => 
                customer.status === 'in-progress' || customer.status === 'scheduled'
            ).slice(0, 3);
            
            // Recent reviews
            const recentReviews = filteredCustomers.filter(customer => 
                customer.review && customer.rating
            ).slice(0, 3);
            
            // Dashboard HTML
            const dashboardHTML = `
                <div class="p-6">
                    <!-- Stats Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="rounded-xl p-5 bg-blue-50">
                            <div class="flex items-center">
                                <div class="p-3 rounded-lg bg-white shadow-sm">
                                    <i class="fas fa-users text-blue-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Happy Customers</p>
                                    <p class="text-2xl font-bold text-gray-800 mt-1">${stats.happyCustomers}+</p>
                                    <p class="text-xs text-green-600 mt-1">+12% from last month</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="rounded-xl p-5 bg-green-50">
                            <div class="flex items-center">
                                <div class="p-3 rounded-lg bg-white shadow-sm">
                                    <i class="fas fa-truck text-green-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Successful Moves</p>
                                    <p class="text-2xl font-bold text-gray-800 mt-1">${stats.successfulMoves}+</p>
                                    <p class="text-xs text-green-600 mt-1">+8% from last month</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="rounded-xl p-5 bg-purple-50">
                            <div class="flex items-center">
                                <div class="p-3 rounded-lg bg-white shadow-sm">
                                    <i class="fas fa-boxes text-purple-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Active Moves</p>
                                    <p class="text-2xl font-bold text-gray-800 mt-1">${stats.activeMoves}</p>
                                    <p class="text-xs text-green-600 mt-1">3 today</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="rounded-xl p-5 bg-amber-50">
                            <div class="flex items-center">
                                <div class="p-3 rounded-lg bg-white shadow-sm">
                                    <i class="fas fa-credit-card text-amber-600"></i>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm font-medium text-gray-600">Revenue This Month</p>
                                    <p class="text-2xl font-bold text-gray-800 mt-1">AED ${formatNumber(stats.revenue)}</p>
                                    <p class="text-xs text-green-600 mt-1">+5% from last month</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Recent Moves -->
                        <div class="lg:col-span-2">
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-lg font-semibold text-gray-800">Active Moves</h2>
                                    <a href="#" class="text-blue-600 text-sm hover:underline">View all</a>
                                </div>
                                
                                <div class="space-y-4">
                                    ${activeMoves.map(customer => `
                                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow customer-card">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <div class="flex items-center">
                                                    <h3 class="font-medium text-gray-800">${customer.name}</h3>
                                                    <span class="ml-2 px-2 py-1 rounded-full text-xs font-medium ${
                                                        customer.type === 'residential' 
                                                            ? 'bg-blue-100 text-blue-800' 
                                                            : 'bg-purple-100 text-purple-800'
                                                    }">
                                                        ${customer.type.charAt(0).toUpperCase() + customer.type.slice(1)}
                                                    </span>
                                                </div>
                                                <p class="text-gray-500 text-sm mt-1 flex items-center">
                                                    <i class="fas fa-map-marker-alt mr-1"></i> ${customer.address}
                                                </p>
                                            </div>
                                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                customer.status === 'completed' 
                                                    ? 'bg-green-100 text-green-800' 
                                                    : customer.status === 'in-progress'
                                                        ? 'bg-amber-100 text-amber-800'
                                                        : 'bg-blue-100 text-blue-800'
                                            }">
                                                ${customer.status.charAt(0).toUpperCase() + customer.status.slice(1)}
                                            </span>
                                        </div>
                                        
                                        <div class="mt-3 flex items-center">
                                            <div class="flex-1">
                                                <div class="flex justify-between text-sm mb-1">
                                                    <span class="text-gray-500">Progress</span>
                                                    <span class="font-medium">${calculateProgress(customer.stepStatus)}%</span>
                                                </div>
                                                <div class="w-full progress-bar">
                                                    <div class="progress bg-blue-600" style="width: ${calculateProgress(customer.stepStatus)}%"></div>
                                                </div>
                                            </div>
                                            <div class="ml-4 text-sm text-gray-500">
                                                <span class="font-medium">Move Date:</span> ${formatDate(customer.moveDate)}
                                            </div>
                                        </div>
                                        
                                        <div class="mt-3 flex flex-wrap gap-2">
                                            ${customer.services.map(service => `
                                                <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                                                    ${service}
                                                </span>
                                            `).join('')}
                                        </div>
                                        
                                        <div class="mt-4 flex space-x-2">
                                            <button class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 view-details" data-customer-id="${customer.id}">
                                                View Details
                                            </button>
                                            <button class="flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700" onclick="showCustomerDetails(${customer.id})">
                                                Manage Move
                                            </button>
                                        </div>
                                    </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- 4-Step Workflow -->
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                                <h2 class="text-lg font-semibold text-gray-800 mb-6">Move Workflow</h2>
                                
                                <div class="relative">
                                    <!-- Progress line -->
                                    <div class="absolute top-4 left-0 w-full h-1 bg-gray-200"></div>
                                    
                                    <div class="flex justify-between">
                                        <!-- Plan Step -->
                                        <div class="relative z-10 text-center">
                                            <div class="w-10 h-10 rounded-full ${
                                                activeMoves[0]?.stepStatus?.plan === 'completed' ? 'bg-green-500 text-white' : 
                                                activeMoves[0]?.stepStatus?.plan === 'in-progress' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'
                                            } flex items-center justify-center mb-2">
                                                ${activeMoves[0]?.stepStatus?.plan === 'completed' ? '<i class="fas fa-check"></i>' : '1'}
                                            </div>
                                            <h3 class="font-medium">Plan</h3>
                                            <p class="text-xs text-gray-500 mt-1">Evaluation & Planning</p>
                                        </div>
                                        
                                        <!-- Pack Step -->
                                        <div class="relative z-10 text-center">
                                            <div class="w-10 h-10 rounded-full ${
                                                activeMoves[0]?.stepStatus?.pack === 'completed' ? 'bg-green-500 text-white' : 
                                                activeMoves[0]?.stepStatus?.pack === 'in-progress' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'
                                            } flex items-center justify-center mb-2">
                                                ${activeMoves[0]?.stepStatus?.pack === 'completed' ? '<i class="fas fa-check"></i>' : '2'}
                                            </div>
                                            <h3 class="font-medium">Pack</h3>
                                            <p class="text-xs text-gray-500 mt-1">Packing & Protection</p>
                                        </div>
                                        
                                        <!-- Load Step -->
                                        <div class="relative z-10 text-center">
                                            <div class="w-10 h-10 rounded-full ${
                                                activeMoves[0]?.stepStatus?.load === 'completed' ? 'bg-green-500 text-white' : 
                                                activeMoves[0]?.stepStatus?.load === 'in-progress' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'
                                            } flex items-center justify-center mb-2">
                                                ${activeMoves[0]?.stepStatus?.load === 'completed' ? '<i class="fas fa-check"></i>' : '3'}
                                            </div>
                                            <h3 class="font-medium">Load</h3>
                                            <p class="text-xs text-gray-500 mt-1">Loading & Transport</p>
                                        </div>
                                        
                                        <!-- Deliver Step -->
                                        <div class="relative z-10 text-center">
                                            <div class="w-10 h-10 rounded-full ${
                                                activeMoves[0]?.stepStatus?.deliver === 'completed' ? 'bg-green-500 text-white' : 
                                                activeMoves[0]?.stepStatus?.deliver === 'in-progress' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'
                                            } flex items-center justify-center mb-2">
                                                ${activeMoves[0]?.stepStatus?.deliver === 'completed' ? '<i class="fas fa-check"></i>' : '4'}
                                            </div>
                                            <h3 class="font-medium">Deliver</h3>
                                            <p class="text-xs text-gray-500 mt-1">Delivery & Setup</p>
                                        </div>
                                    </div>
                                </div>
                                
                                ${activeMoves[0] ? `
                                <div class="mt-8">
                                    <h3 class="font-medium text-gray-800 mb-3">Current Move Details</h3>
                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <h4 class="font-medium text-gray-800">${activeMoves[0].name}</h4>
                                                <p class="text-gray-500 text-sm mt-1">${activeMoves[0].moveSize} · ${activeMoves[0].address}</p>
                                            </div>
                                            <span class="px-2 py-1 ${
                                                activeMoves[0].status === 'completed' ? 'bg-green-100 text-green-800' : 
                                                activeMoves[0].status === 'in-progress' ? 'bg-amber-100 text-amber-800' : 'bg-blue-100 text-blue-800'
                                            } text-xs rounded-full">
                                                ${activeMoves[0].status.charAt(0).toUpperCase() + activeMoves[0].status.slice(1)}
                                            </span>
                                        </div>
                                        
                                        <div class="mt-4">
                                            <h5 class="text-sm font-medium text-gray-700 mb-2">Current Step: ${getCurrentStep(activeMoves[0].stepStatus)}</h5>
                                            <p class="text-sm text-gray-600">
                                                Our team is currently ${getCurrentStepDescription(activeMoves[0].stepStatus)}. 
                                                ${getStepCompletionText(activeMoves[0].stepStatus)}
                                            </p>
                                            
                                            <div class="mt-3 flex space-x-2">
                                                <button class="step-btn px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700" 
                                                        data-customer-id="${activeMoves[0].id}" 
                                                        data-step="${getCurrentStepKey(activeMoves[0].stepStatus)}">
                                                    Mark as Completed
                                                </button>
                                                <button class="px-3 py-1 border border-gray-300 text-gray-700 text-sm rounded hover:bg-gray-50">
                                                    Add Notes
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                ` : `
                                <div class="mt-8 text-center py-8">
                                    <i class="fas fa-truck text-4xl text-gray-300 mb-4"></i>
                                    <h3 class="text-lg font-medium text-gray-800">No active moves</h3>
                                    <p class="text-gray-500 mt-2">You don't have any active moves right now.</p>
                                    <button id="newMoveBtn" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                        <i class="fas fa-plus mr-2"></i>New Move
                                    </button>
                                </div>
                                `}
                            </div>
                        </div>
                        
                        <!-- Right Sidebar -->
                        <div>
                            <!-- Customer Reviews -->
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6">
                                <div class="flex justify-between items-center mb-4">
                                    <h2 class="text-lg font-semibold text-gray-800">Recent Reviews</h2>
                                    <a href="#" class="text-blue-600 text-sm hover:underline">View all</a>
                                </div>
                                
                                <div class="space-y-4">
                                    ${recentReviews.map(review => `
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex items-center mb-2">
                                            ${[...Array(5)].map((_, i) => `
                                                <i class="fas fa-star text-yellow-400 ${i < review.rating ? 'fill-current' : ''}"></i>
                                            `).join('')}
                                        </div>
                                        <p class="text-gray-600 text-sm line-clamp-3">${review.review}</p>
                                        <div class="mt-3 flex items-center">
                                            <div class="bg-gray-300 border-2 border-dashed rounded w-8 h-8"></div>
                                            <div class="ml-2">
                                                <p class="font-medium text-gray-800">${review.name}</p>
                                                <p class="text-xs text-gray-500">${review.moveSize}</p>
                                            </div>
                                        </div>
                                    </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Quick Stats -->
                            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                                <h2 class="text-lg font-semibold text-gray-800 mb-4">Business Statistics</h2>
                                
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-gray-600">Conversion Rate</span>
                                            <span class="font-medium">68%</span>
                                        </div>
                                        <div class="w-full progress-bar">
                                            <div class="progress bg-purple-600" style="width: 68%"></div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-gray-600">Average Move Size</span>
                                            <span class="font-medium">2.7 bedrooms</span>
                                        </div>
                                        <div class="w-full progress-bar">
                                            <div class="progress bg-blue-600" style="width: 75%"></div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <div class="flex justify-between text-sm mb-1">
                                            <span class="text-gray-600">Customer Satisfaction</span>
                                            <span class="font-medium">97%</span>
                                        </div>
                                        <div class="w-full progress-bar">
                                            <div class="progress bg-green-600" style="width: 97%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-6 pt-4 border-t border-gray-200">
                                    <h3 class="font-medium text-gray-800 mb-3">Top Services</h3>
                                    <div class="space-y-3">
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Residential Moving</span>
                                            <span class="font-medium">42%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Packing Services</span>
                                            <span class="font-medium">28%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Storage Solutions</span>
                                            <span class="font-medium">18%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span class="text-gray-600">Vehicle Transport</span>
                                            <span class="font-medium">12%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('mainContent').innerHTML = dashboardHTML;
            setupEventListeners();
        }
        
        // Render Customers
        function renderCustomers() {
            const searchQuery = document.getElementById('searchInput')?.value?.toLowerCase() || '';
            const customers = JSON.parse(localStorage.getItem('packndash_customers')) || [];
            
            // Filter customers
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchQuery) ||
                customer.phone.includes(searchQuery) ||
                customer.address.toLowerCase().includes(searchQuery)
            );
            
            // Customers HTML
            const customersHTML = `
                <div class="p-6">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
                            <div>
                                <h2 class="text-lg font-semibold text-gray-800">Customer Database</h2>
                                <p class="text-gray-500 text-sm mt-1">Manage all your residential and commercial clients</p>
                            </div>
                            <div class="mt-4 md:mt-0 flex space-x-3">
                                <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option>All Customers</option>
                                    <option>Residential</option>
                                    <option>Commercial</option>
                                    <option>Recent Moves</option>
                                </select>
                                <button id="newMoveBtn" class="flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                    <i class="fas fa-plus mr-2"></i>
                                    Add Customer
                                </button>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contact</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Last Move</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${filteredCustomers.map(customer => `
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="flex items-center">
                                                <div class="bg-gray-300 border-2 border-dashed rounded w-10 h-10"></div>
                                                <div class="ml-4">
                                                    <div class="font-medium text-gray-800">${customer.name}</div>
                                                    <div class="text-gray-500 text-sm">${customer.moveSize}</div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                customer.type === 'residential' 
                                                    ? 'bg-blue-100 text-blue-800' 
                                                    : 'bg-purple-100 text-purple-800'
                                            }">
                                                ${customer.type.charAt(0).toUpperCase() + customer.type.slice(1)}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-gray-900">
                                                <div class="flex items-center mb-1">
                                                    <i class="fas fa-phone text-gray-400 mr-2"></i>
                                                    ${customer.phone}
                                                </div>
                                                <div class="flex items-center">
                                                    <i class="fas fa-envelope text-gray-400 mr-2"></i>
                                                    ${customer.email}
                                                </div>
                                            </div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${formatDate(customer.moveDate)}</td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                customer.status === 'completed' 
                                                    ? 'bg-green-100 text-green-800' 
                                                    : customer.status === 'in-progress'
                                                        ? 'bg-amber-100 text-amber-800'
                                                        : 'bg-blue-100 text-blue-800'
                                            }">
                                                ${customer.status.charAt(0).toUpperCase() + customer.status.slice(1)}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button class="text-blue-600 hover:text-blue-900 mr-3 view-details" data-customer-id="${customer.id}">View</button>
                                            <button class="text-green-600 hover:text-green-900 mr-3">Edit</button>
                                            <button class="text-red-600 hover:text-red-900">Delete</button>
                                        </td>
                                    </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-6 flex flex-col sm:flex-row justify-between items-center">
                            <p class="text-sm text-gray-700">
                                Showing <span class="font-medium">1</span> to <span class="font-medium">${Math.min(10, filteredCustomers.length)}</span> of <span class="font-medium">${filteredCustomers.length}</span> results
                            </p>
                            <div class="mt-3 sm:mt-0">
                                <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                                    <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        Previous
                                    </a>
                                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">1</a>
                                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">2</a>
                                    <a href="#" class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50">3</a>
                                    <a href="#" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                        Next
                                    </a>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('mainContent').innerHTML = customersHTML;
            setupEventListeners();
        }
        
        // Render Moves
        function renderMoves() {
            const searchQuery = document.getElementById('searchInput')?.value?.toLowerCase() || '';
            const customers = JSON.parse(localStorage.getItem('packndash_customers')) || [];
            
            // Filter customers
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchQuery) ||
                customer.phone.includes(searchQuery) ||
                customer.address.toLowerCase().includes(searchQuery)
            );
            
            // Moves HTML
            const movesHTML = `
                <div class="p-6">
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-6">Move Management</h2>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                            <!-- Move List -->
                            <div class="lg:col-span-2">
                                <div class="mb-6 flex justify-between items-center">
                                    <div>
                                        <h3 class="text-lg font-medium text-gray-800">All Moves</h3>
                                        <p class="text-gray-500 text-sm mt-1">Track all scheduled and completed moves</p>
                                    </div>
                                    <div class="flex space-x-3">
                                        <select class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                            <option>All Moves</option>
                                            <option>Scheduled</option>
                                            <option>In Progress</option>
                                            <option>Completed</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    ${filteredCustomers.map(customer => `
                                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow customer-card">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <div class="flex items-center">
                                                    <h3 class="font-medium text-gray-800">${customer.name}</h3>
                                                    <span class="ml-2 px-2 py-1 rounded-full text-xs font-medium ${
                                                        customer.type === 'residential' 
                                                            ? 'bg-blue-100 text-blue-800' 
                                                            : 'bg-purple-100 text-purple-800'
                                                    }">
                                                        ${customer.type.charAt(0).toUpperCase() + customer.type.slice(1)}
                                                    </span>
                                                </div>
                                                <p class="text-gray-500 text-sm mt-1 flex items-center">
                                                    <i class="fas fa-map-marker-alt mr-1"></i> ${customer.address}
                                                </p>
                                            </div>
                                            <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                customer.status === 'completed' 
                                                    ? 'bg-green-100 text-green-800' 
                                                    : customer.status === 'in-progress'
                                                        ? 'bg-amber-100 text-amber-800'
                                                        : 'bg-blue-100 text-blue-800'
                                            }">
                                                ${customer.status.charAt(0).toUpperCase() + customer.status.slice(1)}
                                            </span>
                                        </div>
                                        
                                        <div class="mt-3 flex justify-between items-center">
                                            <div>
                                                <p class="text-sm text-gray-600">Move Date: <span class="font-medium text-gray-800">${formatDate(customer.moveDate)}</span></p>
                                                <p class="text-sm text-gray-600 mt-1">Property: <span class="font-medium text-gray-800">${customer.moveSize}</span></p>
                                            </div>
                                            <div class="text-right">
                                                <p class="text-sm font-medium text-gray-800">AED ${calculateMoveValue(customer)}</p>
                                                <p class="text-xs text-gray-500 mt-1">Estimated Value</p>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-4">
                                            <div class="flex justify-between text-sm mb-1">
                                                <span class="text-gray-500">Progress</span>
                                                <span class="font-medium">${calculateProgress(customer.stepStatus)}%</span>
                                            </div>
                                            <div class="w-full progress-bar">
                                                <div class="progress bg-blue-600" style="width: ${calculateProgress(customer.stepStatus)}%"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-4 flex flex-wrap gap-2">
                                            ${customer.services.map(service => `
                                                <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                                                    ${service}
                                                </span>
                                            `).join('')}
                                        </div>
                                        
                                        <div class="mt-4 flex space-x-2">
                                            <button class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 view-details" data-customer-id="${customer.id}">
                                                View Details
                                            </button>
                                            <button class="flex-1 px-3 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700" onclick="showCustomerDetails(${customer.id})">
                                                Manage Move
                                            </button>
                                        </div>
                                    </div>
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Move Details Sidebar -->
                            <div>
                                <div class="bg-gray-50 rounded-xl p-5 mb-6">
                                    <h3 class="font-medium text-gray-800 mb-4">Quick Stats</h3>
                                    <div class="space-y-4">
                                        <div class="bg-white p-4 rounded-lg shadow-sm">
                                            <p class="text-sm text-gray-500">Total Moves This Month</p>
                                            <p class="text-2xl font-bold text-gray-800 mt-1">${filteredCustomers.filter(c => 
                                                new Date(c.moveDate).getMonth() === new Date().getMonth() && 
                                                new Date(c.moveDate).getFullYear() === new Date().getFullYear()
                                            ).length}</p>
                                            <div class="flex items-center mt-2">
                                                <i class="fas fa-exclamation-triangle text-amber-500 mr-1"></i>
                                                <span class="text-xs text-amber-600">3 urgent moves</span>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white p-4 rounded-lg shadow-sm">
                                            <p class="text-sm text-gray-500">Revenue This Month</p>
                                            <p class="text-2xl font-bold text-gray-800 mt-1">AED ${formatNumber(calculateMonthlyRevenue())}</p>
                                            <div class="flex items-center mt-2">
                                                <span class="text-xs text-green-600">+5.2% from last month</span>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white p-4 rounded-lg shadow-sm">
                                            <p class="text-sm text-gray-500">Customer Satisfaction</p>
                                            <div class="flex items-center mt-1">
                                                <div class="flex">
                                                    ${[...Array(5)].map((_, i) => `
                                                        <i class="fas fa-star text-yellow-400 ${i < 4 ? 'fill-current' : ''}"></i>
                                                    `).join('')}
                                                </div>
                                                <span class="ml-2 text-2xl font-bold text-gray-800">4.8</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
                                    <h3 class="font-medium text-gray-800 mb-4">Upcoming Moves</h3>
                                    
                                    <div class="space-y-3">
                                        ${filteredCustomers
                                            .filter(c => c.status !== 'completed' && new Date(c.moveDate) > new Date())
                                            .sort((a, b) => new Date(a.moveDate) - new Date(b.moveDate))
                                            .slice(0, 3)
                                            .map(customer => `
                                            <div class="flex items-center">
                                                <div class="bg-${getDayColor(customer.moveDate)}-100 text-${getDayColor(customer.moveDate)}-800 w-8 h-8 rounded-lg flex items-center justify-center font-medium">
                                                    ${new Date(customer.moveDate).getDate()}
                                                </div>
                                                <div class="ml-3">
                                                    <p class="font-medium text-gray-800">${customer.name}</p>
                                                    <p class="text-xs text-gray-500">${customer.moveSize}</p>
                                                </div>
                                                <div class="ml-auto">
                                                    <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">
                                                        ${formatDate(customer.moveDate, 'short')}
                                                    </span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                    
                                    <div class="mt-4 pt-4 border-t border-gray-200">
                                        <a href="#" class="text-blue-600 text-sm font-medium hover:underline flex items-center">
                                            View Full Calendar <i class="fas fa-chevron-down ml-1"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('mainContent').innerHTML = movesHTML;
            setupEventListeners();
        }
        
        // Show customer details
        function showCustomerDetails(customerId) {
            const customers = JSON.parse(localStorage.getItem('packndash_customers')) || [];
            const customer = customers.find(c => c.id == customerId);
            
            if (!customer) return;
            
            const detailsHTML = `
                <div id="customerDetailsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-6">
                                <h2 class="text-xl font-bold text-gray-800">${customer.name}</h2>
                                <button class="close-details text-gray-400 hover:text-gray-600">
                                    <i class="fas fa-times text-2xl"></i>
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div class="md:col-span-2">
                                    <div class="bg-white rounded-lg shadow p-5 mb-6">
                                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Move Details</h3>
                                        
                                        <div class="space-y-4">
                                            <div class="flex">
                                                <span class="w-32 font-medium text-gray-600">Customer Type:</span>
                                                <span class="${customer.type === 'residential' ? 'text-blue-600' : 'text-purple-600'} font-medium">
                                                    ${customer.type.charAt(0).toUpperCase() + customer.type.slice(1)}
                                                </span>
                                            </div>
                                            
                                            <div class="flex">
                                                <span class="w-32 font-medium text-gray-600">Move Date:</span>
                                                <span class="text-gray-800">${formatDate(customer.moveDate)}</span>
                                            </div>
                                            
                                            <div class="flex">
                                                <span class="w-32 font-medium text-gray-600">Property Size:</span>
                                                <span class="text-gray-800">${customer.moveSize}</span>
                                            </div>
                                            
                                            <div class="flex">
                                                <span class="w-32 font-medium text-gray-600">Address:</span>
                                                <span class="text-gray-800">${customer.address}</span>
                                            </div>
                                            
                                            <div class="flex">
                                                <span class="w-32 font-medium text-gray-600">Services:</span>
                                                <div class="flex flex-wrap gap-2">
                                                    ${customer.services.map(service => `
                                                        <span class="px-2 py-1 bg-gray-100 text-gray-700 text-xs rounded">
                                                            ${service}
                                                        </span>
                                                    `).join('')}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white rounded-lg shadow p-5">
                                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Move Workflow</h3>
                                        
                                        <div class="relative mb-6">
                                            <!-- Progress line -->
                                            <div class="absolute top-4 left-0 w-full h-1 bg-gray-200"></div>
                                            
                                            <div class="flex justify-between">
                                                <!-- Plan Step -->
                                                <div class="relative z-10 text-center">
                                                    <div class="w-10 h-10 rounded-full ${
                                                        customer.stepStatus.plan === 'completed' ? 'bg-green-500 text-white' : 
                                                        customer.stepStatus.plan === 'in-progress' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'
                                                    } flex items-center justify-center mb-2">
                                                        ${customer.stepStatus.plan === 'completed' ? '<i class="fas fa-check"></i>' : '1'}
                                                    </div>
                                                    <h3 class="font-medium">Plan</h3>
                                                    <p class="text-xs text-gray-500 mt-1">Evaluation & Planning</p>
                                                </div>
                                                
                                                <!-- Pack Step -->
                                                <div class="relative z-10 text-center">
                                                    <div class="w-10 h-10 rounded-full ${
                                                        customer.stepStatus.pack === 'completed' ? 'bg-green-500 text-white' : 
                                                        customer.stepStatus.pack === 'in-progress' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'
                                                    } flex items-center justify-center mb-2">
                                                        ${customer.stepStatus.pack === 'completed' ? '<i class="fas fa-check"></i>' : '2'}
                                                    </div>
                                                    <h3 class="font-medium">Pack</h3>
                                                    <p class="text-xs text-gray-500 mt-1">Packing & Protection</p>
                                                </div>
                                                
                                                <!-- Load Step -->
                                                <div class="relative z-10 text-center">
                                                    <div class="w-10 h-10 rounded-full ${
                                                        customer.stepStatus.load === 'completed' ? 'bg-green-500 text-white' : 
                                                        customer.stepStatus.load === 'in-progress' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'
                                                    } flex items-center justify-center mb-2">
                                                        ${customer.stepStatus.load === 'completed' ? '<i class="fas fa-check"></i>' : '3'}
                                                    </div>
                                                    <h3 class="font-medium">Load</h3>
                                                    <p class="text-xs text-gray-500 mt-1">Loading & Transport</p>
                                                </div>
                                                
                                                <!-- Deliver Step -->
                                                <div class="relative z-10 text-center">
                                                    <div class="w-10 h-10 rounded-full ${
                                                        customer.stepStatus.deliver === 'completed' ? 'bg-green-500 text-white' : 
                                                        customer.stepStatus.deliver === 'in-progress' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-500'
                                                    } flex items-center justify-center mb-2">
                                                        ${customer.stepStatus.deliver === 'completed' ? '<i class="fas fa-check"></i>' : '4'}
                                                    </div>
                                                    <h3 class="font-medium">Deliver</h3>
                                                    <p class="text-xs text-gray-500 mt-1">Delivery & Setup</p>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-4">
                                            <h5 class="text-sm font-medium text-gray-700 mb-2">Current Step: ${getCurrentStep(customer.stepStatus)}</h5>
                                            <p class="text-sm text-gray-600 mb-4">
                                                Our team is currently ${getCurrentStepDescription(customer.stepStatus)}. 
                                                ${getStepCompletionText(customer.stepStatus)}
                                            </p>
                                            
                                            <div class="flex space-x-2">
                                                <button class="step-btn px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700" 
                                                        data-customer-id="${customer.id}" 
                                                        data-step="${getCurrentStepKey(customer.stepStatus)}">
                                                    Mark as Completed
                                                </button>
                                                <button class="px-3 py-1 border border-gray-300 text-gray-700 text-sm rounded hover:bg-gray-50">
                                                    Add Notes
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div class="bg-gray-50 rounded-lg p-5 mb-6">
                                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Contact Information</h3>
                                        
                                        <div class="space-y-4">
                                            <div class="flex items-start">
                                                <i class="fas fa-user text-gray-400 mt-1 mr-3"></i>
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Full Name</p>
                                                    <p class="text-gray-800 mt-1">${customer.name}</p>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-start">
                                                <i class="fas fa-phone text-gray-400 mt-1 mr-3"></i>
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Phone</p>
                                                    <p class="text-gray-800 mt-1">${customer.phone}</p>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-start">
                                                <i class="fas fa-envelope text-gray-400 mt-1 mr-3"></i>
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Email</p>
                                                    <p class="text-gray-800 mt-1">${customer.email}</p>
                                                </div>
                                            </div>
                                            
                                            <div class="flex items-start">
                                                <i class="fas fa-map-marker-alt text-gray-400 mt-1 mr-3"></i>
                                                <div>
                                                    <p class="text-sm font-medium text-gray-600">Current Address</p>
                                                    <p class="text-gray-800 mt-1">${customer.address}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 rounded-lg p-5">
                                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Customer Review</h3>
                                        
                                        <div class="space-y-3">
                                            <div class="flex">
                                                ${[...Array(5)].map((_, i) => `
                                                    <i class="fas fa-star text-yellow-400 ${i < customer.rating ? 'fill-current' : ''}"></i>
                                                `).join('')}
                                            </div>
                                            <p class="text-gray-600 text-sm">${customer.review || 'No review provided'}</p>
                                            
                                            <div class="mt-4 pt-4 border-t border-gray-200">
                                                <h4 class="font-medium text-gray-700 mb-2">Move Status</h4>
                                                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                    customer.status === 'completed' 
                                                        ? 'bg-green-100 text-green-800' 
                                                        : customer.status === 'in-progress'
                                                            ? 'bg-amber-100 text-amber-800'
                                                            : 'bg-blue-100 text-blue-800'
                                                }">
                                                    ${customer.status.charAt(0).toUpperCase() + customer.status.slice(1)}
                                                </span>
                                            </div>
                                            
                                            <div class="mt-4">
                                                <h4 class="font-medium text-gray-700 mb-2">Move Progress</h4>
                                                <div class="w-full progress-bar mb-2">
                                                    <div class="progress bg-blue-600" style="width: ${calculateProgress(customer.stepStatus)}%"></div>
                                                </div>
                                                <p class="text-sm text-gray-600">${calculateProgress(customer.stepStatus)}% Complete</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', detailsHTML);
            setupEventListeners();
        }
        
        // Helper functions
        function calculateProgress(stepStatus) {
            const completed = Object.values(stepStatus).filter(s => s === 'completed').length;
            return Math.round((completed / 4) * 100);
        }
        
        function getCurrentStep(stepStatus) {
            if (stepStatus.plan !== 'completed') return 'Plan';
            if (stepStatus.pack !== 'completed') return 'Pack';
            if (stepStatus.load !== 'completed') return 'Load';
            if (stepStatus.deliver !== 'completed') return 'Deliver';
            return 'Completed';
        }
        
        function getCurrentStepKey(stepStatus) {
            if (stepStatus.plan !== 'completed') return 'plan';
            if (stepStatus.pack !== 'completed') return 'pack';
            if (stepStatus.load !== 'completed') return 'load';
            if (stepStatus.deliver !== 'completed') return 'deliver';
            return 'deliver';
        }
        
        function getCurrentStepDescription(stepStatus) {
            if (stepStatus.plan !== 'completed') return 'planning your move';
            if (stepStatus.pack !== 'completed') return 'packing your items';
            if (stepStatus.load !== 'completed') return 'loading your belongings';
            if (stepStatus.deliver !== 'completed') return 'delivering to your new location';
            return 'completing your move';
        }
        
        function getStepCompletionText(stepStatus) {
            if (stepStatus.plan !== 'completed') return 'We will contact you to discuss your move requirements.';
            if (stepStatus.pack !== 'completed') return 'Expected to complete packing by 10:00 AM today.';
            if (stepStatus.load !== 'completed') return 'Truck will arrive at 2:00 PM for loading.';
            if (stepStatus.deliver !== 'completed') return 'Delivery expected by 5:00 PM today.';
            return 'Your move is complete! Thank you for choosing PacknDash.';
        }
        
        function formatDate(dateString, format = 'full') {
            if (!dateString) return '';
            
            const date = new Date(dateString);
            if (format === 'short') {
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }
            return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        }
        
        function formatNumber(number) {
            return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }
        
        function calculateMoveValue(customer) {
            // Simple calculation based on property size
            let baseValue = 0;
            if (customer.moveSize.includes('Studio')) baseValue = 800;
            else if (customer.moveSize.includes('1-bedroom')) baseValue = 1200;
            else if (customer.moveSize.includes('2-bedroom')) baseValue = 1800;
            else if (customer.moveSize.includes('3-bedroom')) baseValue = 2400;
            else if (customer.moveSize.includes('4-bedroom')) baseValue = 3000;
            else if (customer.moveSize.includes('Office')) baseValue = 2000;
            
            // Add value for additional services
            baseValue += customer.services.length * 200;
            
            return formatNumber(baseValue);
        }
        
        function calculateMonthlyRevenue() {
            const customers = JSON.parse(localStorage.getItem('packndash_customers')) || [];
            return customers
                .filter(c => 
                    new Date(c.moveDate).getMonth() === new Date().getMonth() && 
                    new Date(c.moveDate).getFullYear() === new Date().getFullYear()
                )
                .reduce((total, customer) => {
                    // Simple calculation based on property size
                    let baseValue = 0;
                    if (customer.moveSize.includes('Studio')) baseValue = 800;
                    else if (customer.moveSize.includes('1-bedroom')) baseValue = 1200;
                    else if (customer.moveSize.includes('2-bedroom')) baseValue = 1800;
                    else if (customer.moveSize.includes('3-bedroom')) baseValue = 2400;
                    else if (customer.moveSize.includes('4-bedroom')) baseValue = 3000;
                    else if (customer.moveSize.includes('Office')) baseValue = 2000;
                    
                    // Add value for additional services
                    baseValue += customer.services.length * 200;
                    
                    return total + baseValue;
                }, 0);
        }
        
        function getDayColor(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            const tomorrow = new Date();
            tomorrow.setDate(today.getDate() + 1);
            
            if (date.toDateString() === today.toDateString()) return 'blue';
            if (date.toDateString() === tomorrow.toDateString()) return 'purple';
            return 'amber';
        }
    </script>
</head>
<body class="bg-gray-50">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <div class="w-64 bg-white border-r border-gray-200 flex flex-col">
            <div class="p-5 border-b border-gray-200">
                <div class="flex items-center">
                    <div class="bg-blue-700 text-white w-10 h-10 rounded-lg flex items-center justify-center font-bold text-xl mr-3">
                        P
                    </div>
                    <h1 class="text-xl font-bold text-gray-800">PacknDash CRM</h1>
                </div>
            </div>
            
            <nav class="flex-1 px-3 py-4 overflow-y-auto">
                <a href="#" data-tab="dashboard" class="tab-active flex items-center px-4 py-3 text-sm rounded-lg mb-1">
                    <i class="fas fa-home mr-3"></i>
                    Dashboard
                </a>
                <a href="#" data-tab="customers" class="flex items-center px-4 py-3 text-sm rounded-lg text-gray-600 hover:bg-gray-100">
                    <i class="fas fa-users mr-3"></i>
                    Customers
                </a>
                <a href="#" data-tab="moves" class="flex items-center px-4 py-3 text-sm rounded-lg text-gray-600 hover:bg-gray-100">
                    <i class="fas fa-truck mr-3"></i>
                    Move Management
                </a>
                <a href="#" class="flex items-center px-4 py-3 text-sm rounded-lg text-gray-600 hover:bg-gray-100">
                    <i class="fas fa-file-invoice mr-3"></i>
                    Quotes
                </a>
                <a href="#" class="flex items-center px-4 py-3 text-sm rounded-lg text-gray-600 hover:bg-gray-100">
                    <i class="fas fa-calendar-alt mr-3"></i>
                    Schedule
                </a>
                <a href="#" class="flex items-center px-4 py-3 text-sm rounded-lg text-gray-600 hover:bg-gray-100">
                    <i class="fas fa-comments mr-3"></i>
                    Customer Reviews
                </a>
                <a href="#" class="flex items-center px-4 py-3 text-sm rounded-lg text-gray-600 hover:bg-gray-100">
                    <i class="fas fa-chart-bar mr-3"></i>
                    Reports
                </a>
                <a href="#" class="flex items-center px-4 py-3 text-sm rounded-lg text-gray-600 hover:bg-gray-100">
                    <i class="fas fa-cog mr-3"></i>
                    Settings
                </a>
                
                <div class="mt-8 pt-4 border-t border-gray-200">
                    <h3 class="px-4 text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">
                        Services
                    </h3>
                    <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-600 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-home mr-3"></i>
                        Residential Moving
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-600 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-building mr-3"></i>
                        Commercial Storage
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-600 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-car mr-3"></i>
                        Vehicle Storage
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-600 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-file-archive mr-3"></i>
                        Document Storage
                    </a>
                    <a href="#" class="flex items-center px-4 py-2 text-sm text-gray-600 rounded-lg hover:bg-gray-100">
                        <i class="fas fa-snowflake mr-3"></i>
                        Seasonal Storage
                    </a>
                </div>
            </nav>
            
            <div class="p-4 border-t border-gray-200">
                <div class="flex items-center">
                    <div class="bg-gray-300 border-2 border-dashed rounded-xl w-10 h-10"></div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-700">Admin User</p>
                        <p class="text-xs text-gray-500">admin@packndash.ae</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 overflow-auto">
            <!-- Header -->
            <header class="bg-white shadow-sm">
                <div class="flex items-center justify-between px-6 py-4">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Dashboard</h1>
                        <p class="text-gray-500 text-sm mt-1">Overview of your moving business</p>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Search customers..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <i class="fas fa-search absolute left-3 top-2.5 text-gray-400"></i>
                        </div>
                        <button id="newMoveBtn" class="flex items-center bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i>
                            New Move
                        </button>
                    </div>
                </div>
            </header>
            
            <!-- Main Content Area -->
            <div id="mainContent">
                <!-- Dashboard will be loaded here by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- New Move Modal -->
    <div id="newMoveModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style="display: none;">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-800">New Move Request</h2>
                    <button class="close-modal text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                
                <form id="moveForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Customer Name</label>
                            <input type="text" id="name" name="name" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="John Smith">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Customer Type</label>
                            <select id="type" name="type" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="residential">Residential</option>
                                <option value="commercial">Commercial</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                            <input type="tel" id="phone" name="phone" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="+971 50 123 4567">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                            <input type="email" id="email" name="email" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="email@example.com">
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Current Address</label>
                            <input type="text" id="address" name="address" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                placeholder="Enter full address">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Move Date</label>
                            <input type="date" id="moveDate" name="moveDate" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Property Size</label>
                            <select id="moveSize" name="moveSize" required
                                class="w-full border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="Studio apartment">Studio apartment</option>
                                <option value="1-bedroom apartment">1-bedroom apartment</option>
                                <option value="2-bedroom apartment">2-bedroom apartment</option>
                                <option value="3-bedroom apartment">3-bedroom apartment</option>
                                <option value="4-bedroom villa">4-bedroom villa</option>
                                <option value="Office (up to 500 sq ft)">Office (up to 500 sq ft)</option>
                                <option value="Office (500-1000 sq ft)">Office (500-1000 sq ft)</option>
                            </select>
                        </div>
                        
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Services Required</label>
                            <div class="grid grid-cols-2 gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" name="services" value="Packing"
                                        class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Packing Services</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" name="services" value="Furniture Dismantling"
                                        class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Furniture Dismantling</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" name="services" value="Storage"
                                        class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Storage Solutions</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" name="services" value="Vehicle Transport"
                                        class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Vehicle Transport</span>
                                </label>
                                
                                <label class="flex items-center">
                                    <input type="checkbox" name="services" value="Special Handling"
                                        class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                    <span class="ml-2 text-sm text-gray-700">Special Handling (Art, Pianos, etc.)</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3">
                        <button type="button" class="close-modal px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm font-medium hover:bg-blue-700">
                            Create Move
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html>
